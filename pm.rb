#!/usr/bin/env ruby

require 'nokogiri'

require 'pry'

html = Nokogiri::XML::Builder.new do 

  html do
    head do
      title "pm"
    end
    body do
      svg do
        defs do
          g :id => "half" do
            path :fill => "rgb(75,121,123)", :d => "m 61.437908,87.002705 c 5.255143,-0.950086 29.433546,-2.331143 23.529412,9.477125 -4.217676,8.43535 -25.218438,-1.850706 -30.392157,8.49673 -44.8338751,89.66775 90.562627,-1.88902 120.915037,-9.477122 33.49926,-8.374816 31.06912,1.008433 49.0196,22.549022 2.7201,3.26412 9.68433,8.52232 7.51634,13.72549 -25.90652,62.17565 -11.44668,-37.904111 -46.73202,-20.26144 -38.21741,19.1087 -101.875166,57.43595 -148.692813,41.83006 -3.061774,-1.02059 -5.89749,-14.18852 -6.20915,-16.99346 -0.761877,-6.85689 -8.174124,-5.55974 -11.437909,-8.82353 -8.851397,-8.8514 37.791587,-38.686846 42.48366,-40.522875 z"
            path :fill => "rgb(182,102,72)", :d => "M 38.562092,87.6563 C 34.530497,91.460155 9.1447992,87.340558 6.8627451,91.904666 0.45310727,104.72394 3.4931726,167.49646 20.261438,150.7282 21.647948,149.34169 -3.5349339,106.79131 38.562092,87.6563 z"
            path :fill => "rgb(173,143,87)", :d => "m 93.137255,106.61055 c -6.200382,4.04712 -24.786061,-0.37734 -30.392157,5.22876 -40.26886,40.26886 66.722432,-9.05999 68.954252,-9.80392 3.848,-1.28267 25.7326,-2.129562 22.22222,-9.150332 -15.8283,-31.656602 -51.85916,30.088272 -60.784315,13.725492 z"
            path :fill => "rgb(173,143,87)", :d => "m 145.42484,148.44061 c 81.4334,-31.87843 23.34868,17.78947 0,0 z"
            path :fill => "rgb(140,132,81)", :d => "m 182.02614,122.29682 c 29.476,3.6048 8.56812,31.51533 8.82353,32.02615 7.01814,14.03626 27.86535,-50.37058 -8.82353,-32.02615 z"
          end
          g :id => "tile" do
            use :"xlink:href" => "#half"
            use :"xlink:href" => "#half", :transform => "translate(0,80) matrix(1,0,0,-1,0,0) translate(0,-80)"
          end
        end
        x1, y1 = 240,0
        x2, y2 =  0,160
        ((0)..2).each do |m|
          ((0)..2).each do |n|
            x_delta = m*x1 + n*x2
            y_delta = m*y1 + n*y2
            use :"xlink:href" => "#tile",:transform => "translate(#{x_delta},#{y_delta})"
          end
        end
      end
    end
  end

end

out = File.new('output.html','w')
out.puts html.doc.to_html
out.close
