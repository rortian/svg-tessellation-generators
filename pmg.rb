#!/usr/bin/env ruby

require 'nokogiri'

require 'pry'

html = Nokogiri::XML::Builder.new do 

  html do
    head do
      title "pmg"
    end
    body do
      svg do
        defs do
          g :id => "quarter" do
            g :fill => "rgb(69,85,106)" do
              path :d => "m 24.183007,141.57787 c -0.950903,-11.35545 -4.283884,-14.05229 -15.0326802,-14.05229 -24.9942568,0 33.6446122,43.30841 75.1633982,22.54902 0.961656,-0.48083 7.738242,-2.71927 5.882353,-4.57516 -18.02055,-18.02055 -54.159771,16.8217 -66.013071,-3.92157 z"
            end
            g :fill => "rgb(119,75,77)" do
              path :d => "m 80.718954,124.5844 c -1.360951,21.89607 30.389086,4.2453 38.235296,12.09151 6.94631,6.94631 -35.445913,6.78685 -14.37909,17.32026 13.71858,6.85929 56.59712,5.94352 45.75164,-4.90196 -3.66874,-3.66874 -31.04575,0.63825 -31.04575,-0.3268 0,-4.65555 6.7176,-7.3712 8.82353,-9.47712 4.09239,-4.0924 -41.769582,-12.99665 -47.385626,-14.70589 z"
            end
            g :fill => "rgb(205,163,94)" do
              path :d => "m 179.73856,142.55826 c -18.22326,17.7049 46.35082,17.42909 53.26798,3.59477 2.60991,-5.21983 -4.0986,-20.38058 -9.80393,-18.95425 -6.6751,1.66878 -3.65363,16.79522 -13.07189,19.93464 -6.2426,2.08087 6.94054,-14.95488 2.28758,-19.60784 -4.42234,-4.42234 -13.0804,28.75222 -32.67974,15.03268 z"
            end
            g :fill => "rgb(128,141,159)" do
              path :d => "m 148.69281,123.60401 c -17.13119,1.84341 -11.00893,11.43791 2.61438,11.43791 5.98176,0 9.541,13.53016 11.76471,12.4183 8.73542,-4.36771 0.86732,-13.99575 3.59477,-15.35948 34.1964,-17.0982 1.4954,-10.16208 -16.33987,-7.18954 z"
            end
          end
          g :id => "half" do
            use :"xlink:href" => "#quarter"
            use :"xlink:href" => "#quarter", :transform => "translate(0,120) matrix(1,0,0,-1,0,0) translate(0,-120)"
          end
          g :id => "tile" do
            use :"xlink:href" => "#half"
            use :"xlink:href" => "#half", :transform => "rotate(180,120,80)"
          end
        end
        x1, y1 = 240,0
        x2, y2 =  0,160
        ((0)..2).each do |m|
          ((0)..2).each do |n|
            x_delta = m*x1 + n*x2
            y_delta = m*y1 + n*y2
            use :"xlink:href" => "#tile",:transform => "translate(#{x_delta},#{y_delta})"
          end
        end
      end
    end
  end

end

out = File.new('output.html','w')
out.puts html.doc.to_html
out.close
