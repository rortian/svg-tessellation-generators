#!/usr/bin/env ruby

require 'nokogiri'

require 'pry'

html = Nokogiri::XML::Builder.new do 

  html do
    head do
      title "p3m1"
    end
    body do
      svg do
        defs do
          g :id => "sixth" do
            path :fill => "rgb(31,113,111)", :d => "m 313.0719,182.75434 c -8.71612,3.46092 -48.7653,25.34522 -40.19608,42.48366 1.9611,3.9222 15.72478,1.19732 19.28104,-0.3268 4.50005,-1.92859 4.38121,-15.88023 7.84314,-12.4183 3.24151,3.24152 6.16009,17.34479 0.3268,20.26144 -6.42314,3.21157 -25.01258,3.092 -19.93464,8.16993 9.48481,9.48482 67.21892,-8.74496 69.60784,-18.30065 4.31349,-17.25395 -30.21627,8.31977 -32.35294,-17.32026 -0.95227,-11.42725 39.27794,-12.87737 49.3464,-7.84314 8.64076,4.32038 -23.01984,20.84302 -14.37908,25.1634 5.30622,2.65311 26.72452,3.12333 29.41176,-3.59477 16.2461,-40.61523 -51.10268,-33.52812 -68.95424,-36.27451 z"
            path :fill => "rgb(249,114,68)", :d => "m 373.85621,231.77395 c -5.19759,-1.15385 -28.91555,4.58719 -28.75817,4.90196 6.82955,13.65909 46.83523,4.90196 61.43791,4.90196 5.74044,0 -14.96372,-12.6909 -9.47713,-14.37909 18.28102,-5.62492 24.83577,19.28272 29.08497,10.78432 2.59075,-5.1815 -15.3732,-23.642 -17.64706,-28.75817 -4.79497,-10.7887 -13.35979,-57.0456 -22.22222,-52.61438 -24.56225,12.28112 33.15359,62.40327 -12.4183,75.1634 z"
          end
          g :id => "third" do
            use :"xlink:href" => "#sixth"
            use :"xlink:href" => "#sixth", :transform => "translate(250,250) matrix(-0.5,-0.866,-0.866,0.5,0,0) translate(-250,-250)"
          end
          g :id => "tile" do
            use :"xlink:href" => "#third"
            use :"xlink:href" => "#third",:transform => "rotate(120,250,250)"
            use :"xlink:href" => "#third",:transform => "rotate(240,250,250)"
          end
        end
        x1, y1 =  0, 346.4102
        x2, y2 = 300, 173.2051
        ((-10)..10).each do |m|
          ((-10)..20).each do |n|
            x_delta = m*x1 + n*x2
            y_delta = m*y1 + n*y2
            use :"xlink:href" => "#tile",:transform => "translate(#{x_delta},#{y_delta})"
          end
        end
      end
    end
  end

end

out = File.new('output.html','w')
out.puts html.doc.to_html
out.close
